# Ansible

## Task 5

_Для подобного рода задач заводится таска в Jira (вкратце в описании описывается план проведения работ, выставляется время проведения работ, указывается исполнитель и ответственный), прикладывается документация в формате `.docx`, где прописано построчно, что будет происходить, и что делать в случае сбоя (откат). То есть вот вам еще одна строчка в резюме - придумайте, как её красиво расписать._

### Проверка состояния ПО на серверах, а также автоматическая установка в случае его отсутствия или перезапуск (вместо экспортеров может быть что угодно)

- Нужно написать роль, которая сможет на всех контейнерах:
  - Проверить наличие Process Exporter / node_exporter_install_path:
    - Установить Process Exporter (если он отсутствует)
  - Проверить состояние службы Process Exporter:
    - Если не запущен, то запустить: `sudo systemctl start node_exporter.service`
  - Проверить доступность метрик Process Exporter:
    - Скрипт должен заходить на страницу `/metrics`, видеть статус `200 OK` и что метрики **`отбрасываются / не отбрасываются`** каждым экспортером
  - Сделайте имитацию, что x1 Process Exporter не запущен `sudo systemctl stop node_exporter.service` и `sudo systemctl disable node_exporter.service`
  - x1 Process Exporter оставляем запущенным без изменений
  - x1 Process Exporter не будет установлен вообще (это будет пустая VM)
  - Далее запустите Ansible скрипт и убедитесь в его успешном выполнении
  - Тем самым мы можем спродюссировать Ansible скрипт на 500-1000 машин (в Сбербанке x10.000 Process Exporter-ов - это нормально или x1000 PostgreSQL) на проверку статусов экспортеров, там где не запущены - запустить, там где их нет - установить (в нашем случае коичество времени играет ключевую роль, поэтому x3 VM нам более чем достаточно, скрипт будет выполнять одну и ту же итерацию 1000 раз, а нам нужно экономить время)
- Запушьте изменения в Github
