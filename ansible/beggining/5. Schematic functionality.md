# Ansible
## Схематичный функционал

Эта схема иллюстрирует основные этапы работы Ansible при автоматизации задач на удалённых серверах. Основные компоненты:

1. **Inventory** — список хостов и групп, определяющий, на какие серверы будут применяться задачи.
2. **Playbook** — YAML-файл, описывающий последовательность действий (задач) и используемые роли.
3. **Role** — структурированный набор задач, шаблонов и переменных для выполнения конкретной функции (например, установка Nginx или настройка БД).
4. **Целевой хост** — сервер, на котором выполняются задачи.

**Поток работы:**
- Пользователь запускает playbook, указав inventory.
- Ansible анализирует inventory, чтобы определить хосты и их настройки.
- Playbook инициализирует роли, которые выполняют задачи на хостах.
- Результат выполнения возвращается пользователю.

Эта модель демонстрирует, как Ansible организует взаимодействие между компонентами для автоматизации сложных процессов.

```mermaid
sequenceDiagram
    participant User as Пользователь
    participant Ansible as Ansible
    participant Inventory as Inventory
    participant Playbook as Playbook
    participant Role as Role
    participant Host as Целевой хост

    User->>Ansible: Запускает playbook с inventory
    Ansible->>Inventory: Читает список хостов и группы
    Inventory-->>Ansible: Возвращает данные о хостах

    Ansible->>Playbook: Загружает playbook
    Playbook->>Role: Инициализирует роли из playbook
    Role->>Host: Применяет задачи (tasks) к хостам
    Host-->>Role: Возвращает статус выполнения задач

    Role->>Ansible: Обновляет состояние Ansible
    Ansible->>User: Отображает результат выполнения
```

### **Объяснение схемы:**
1. **Пользователь** запускает playbook с указанием inventory:
   ```bash
   ansible-playbook -i inventory.ini playbook.yml
   ```

2. **Ansible** читает **inventory**, чтобы определить:
   - Какие хосты будут обрабатываться.
   - Переменные, связанные с хостами/группами.

3. **Playbook**:
   - Определяет, какие роли (roles) нужно применить.
   - Загружает структуру задач (tasks), переменные и обработчики (handlers).

4. **Role**:
   - Выполняет задачи (tasks) из своей структуры.
   - Использует шаблоны (templates) и переменные (vars).
   - Обновляет состояние сервисов через обработчики (handlers).

5. **Целевой хост**:
   - Принимает команды Ansible через SSH/WinRM.
   - Выполняет задачи локально (например, устанавливает ПО, изменяет файлы).

6. **Результат**:
   - Ansible возвращает отчёт о выполнении задач.
   - Пользователь видит статус (успешно/ошибки).

---

### **Дополнительные элементы в реальных сценариях:**
- **Переменные** (vars): Используются в playbook и ролях для настройки задач.
- **Обработчики** (handlers): Перезапускают сервисы после изменений (например, после обновления конфига).
- **Модули** (modules): Выполняют конкретные действия (apt, file, service).
- **Шаблоны** (templates): Генерируют конфигурационные файлы через Jinja2.
