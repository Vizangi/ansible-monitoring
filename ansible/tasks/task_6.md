# Ansible

## **Task 6**

_Для подобного рода задач заводится таска в Jira (вкратце в описании описывается план проведения работ, выставляется время проведения работ, указывается исполнитель и ответственный), прикладывается документация в формате `.docx`, где прописано построчно, что будет происходить, и что делать в случае сбоя (откат). То есть вот вам еще одна строчка в резюме - придумайте, как её красиво расписать._

### Разворачивание глобальной инфраструктуры мониторинга на проекте

- В данном задании нужно подумать, как раскатать x14 Debian контейнеров (для нас с вами - это как обычно 14 VM (то есть 14 инстансов в облачной терминалогии)), в составе которых будет `openssh` - можно собрать индивидуальный **Dockerfile** и раскатать через **Docker Compose** x14 контейнеров.
- Используем одну VM (Debian или Ubuntu), как основную для задания, сколько выдать ресурсов подумайте сами. 
- Раскатку экспортеров делаем в вакууме, так как у нас нет времени отдельно поднимать: Nginx, Kafka и БД с соответствующими настройками.
 - Но это и не нужно, так как на работе серверы уже будут установлены и на них нужно будет накатывать экспортеры.
 - То есть ставим экспортеры в пустые контейнеры и получаем с них метрики, для нас здесь важно понимание принципа работы** Ansible с IaC**, а не настройка БД, Kafka и т.д - это для другого раздела обучения.
- Далее идем в **Ansible** и пишем роли для экспортеров ниже.
- Тут нужно будет подумать, как **Ansible** будет определять на какие контейнеры катать экспортеры, если контейнеры были раскатаны рандомно? То есть тут нужно либо назначить сетку, либо пробросить IP адреса на каждый из контейнеров, либо обращаться к каждому контейнеру по DNS или по уникальному ID.


### Архитектура:

  **Основной мониторинг:**
  - Раскатываем любым способом на основной вируталке **Docker Compose:** `Grafana + Prometheus` (вне роли Ansible). 

  **Системный мониторинг и прочее:**
  
  1. **Node Exporter:** Сбор метрик ОС и железа для Linux/UNIX. Крайне важен для базового мониторинга серверов.
  2. **Blackbox Exporter:** "Черноящичный" мониторинг доступности внешних эндпоинтов (HTTP, DNS, TCP, ICMP).
  3. **JMX Exporter:** Сбор метрик с Java-приложений, использующих JMX. Очень универсален для Java-стека.
  4. **SNMP Exporter:** Позволяет собирать метрики с устройств, поддерживающих протокол SNMP. Широко используется для сетевого оборудования.
  5. **Pushgateway:** Используется в связке с экспортерами для сбора метрик с короткоживущих или периодически запускаемых задач, которые не могут быть постоянно опрашиваемы Prometheus.
  
  **Базы данных:**
  
  6.  **MySQLd Exporter:** Мониторинг серверов MySQL и MariaDB.
  7.  **Postgres Exporter:** Мониторинг баз данных PostgreSQL.
  8.  **MongoDB Exporter:** Мониторинг серверов MongoDB.
  9.  **Redis Exporter:** Мониторинг Redis key-value store.
  
  **Веб-серверы и прокси:**
  
  10. **Nginx Exporter:** Сбор метрик с веб-сервера Nginx.
  11. **Apache Exporter:** Сбор метрик с Apache HTTP Server.
  12. **HAProxy Exporter:** Мониторинг балансировщика нагрузки HAProxy.
  
  **Системы очередей сообщений:**
  
  13. **RabbitMQ Exporter:** Мониторинг RabbitMQ.
  14. **Kafka Exporter:** Мониторинг брокеров Kafka и потребительских групп.

Этот список охватывает основные категории систем, которые часто требуют мониторинга, а также мы обкатываем условно рабочий сценарий в банке.

- Раскатываем написанные **Ansible-roles** с экспортерами на 14 пустых контейнеров **Debian (VM)**.
- После успешной раскатки экспортеров на них, проверьте эндпоинты на веб-морде **Prometheus** по `remote-read` по всем контейнерам.
- Воспроизведите все официальные дашборды для проверки в Grafana.
 - Если работают не все дашборды, то ничего страшного, на данном этапе важно, чтобы **Prometheus** видел все **Endpoints**, а дашборды, работающие на 100% для данного задания - это вторично.
- Сохраните изменения в **GitHub** репозиторий.
