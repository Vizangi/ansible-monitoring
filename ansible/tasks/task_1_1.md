# Ansible

## Task 1.1

_Для подобного рода задач заводится таска в Jira (вкратце в описании описывается план проведения работ, выставляется время проведения работ, указывается исполнитель и ответственный), прикладывается документация в формате `.docx`, где прописано построчно, что будет происходить, и что делать в случае сбоя (откат). То есть вот вам еще одна строчка в резюме - придумайте, как её красиво расписать._

### Проверка состояния ПО на серверах

#### Автоматическая установка в случае его отсутствия или перезапуск (вместо экспортеров по рабочим задачам может быть, что угодно)

- Нужно написать роль, которая сможет на трех нативных VM **Debian ОС**:
  - Проверить наличие **Process Exporter** / `node_exporter_install_path`:
    - Установить **Process Exporter** (если он отсутствует).
  - Проверить состояние службы **Process Exporter**:
    - Если не запущен, то запустить: `sudo systemctl start node_exporter.service`.
  - Проверить доступность метрик **Process Exporter**:
    - Скрипт должен заходить на страницу `/metrics`, видеть статус `200 OK` и что метрики **`отбрасываются / не отбрасываются`** каждым экспортером.
  - Сделайте имитацию, что `№1 Process Exporter` не запущен `sudo systemctl stop node_exporter.service` и `sudo systemctl disable node_exporter.service`.
  - `№2 Process Exporter` оставляем запущенным без изменений.
  - `№3 Process Exporter` не будет установлен вообще (это будет пустая VM).
  - Далее запустите Ansible скрипт и убедитесь в его успешном выполнении.
  - Тем самым мы можем спродюссировать Ansible скрипт на проверку `500-1000 машин`:
    - В Сбербанке может быть условно `x10.000 Process Exporter-ов` - это нормально или `x1000 PostgreSQL`.
    - Скрипт на проверку статусов экспортеров, там где не запущены - запустить, там где их нет - установить.
    - В нашем случае коичество времени играет ключевую роль, поэтому `x3 VM` нам более чем достаточно.
    - Скрипт может выполнять одну и ту же итерацию хоть 10-1000 раз, а нам нужно экономить время.
- Почему в данном задании мы не берем контейнеры, потому что будут проблемы с `systemd` и с `openssh` - в дефолте контейнеры эти инструменты не поддерживают, нужно заниматься сборкой Dockerfile, а это потеря времени.
- По завершению запушьте изменения в **Github**.
